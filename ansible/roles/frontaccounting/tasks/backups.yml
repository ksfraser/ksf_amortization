---
# ansible/roles/frontaccounting/tasks/backups.yml
# Set up automated backups

- name: Create backup script
  template:
    src: backup-fa.sh.j2
    dest: "{{ fa_path }}/backups/backup-fa.sh"
    owner: root
    group: root
    mode: '0755'
  tags: backups

- name: Set up cron job for daily backups
  cron:
    name: "FrontAccounting daily backup"
    minute: "0"
    hour: "2"
    job: "{{ fa_path }}/backups/backup-fa.sh >> {{ fa_path }}/logs/backup.log 2>&1"
    user: root
  tags: backups

- name: Create backup directory with proper permissions
  file:
    path: "{{ fa_path }}/backups"
    state: directory
    mode: '0755'
  tags: backups
